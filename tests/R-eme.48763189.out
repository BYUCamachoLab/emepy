Running in parallel on 20 cores
*** TESTING GRADIENT ADJOINT ***
Now performing an optimization...
start 0.7865569615458398
end 1.9502826648236273 1.9502951076567914 0.0001 24 0.7865569615458398
start 0.8798142905456853
end 1.9502838275428984 1.9502937154188897 0.0001 29 0.8798142905456853
start 0.8028619710232179
end 1.950280605573142 1.9502966068235235 0.0001 26 0.8028619710232179
start 0.5203710417365227
end 1.9503030718532004 1.9502745662723344 0.0001 1 0.5203710417365227
start 0.6540827958411973
end 1.9502873097340272 1.9502891887233529 0.0001 10 0.6540827958411973
start 0.5774494306359272
end 1.9502975047857039 1.950279552206282 0.0001 5 0.5774494306359272
start 0.7655576437969173
end 1.9502846741469975 1.9502929639498456 0.0001 23 0.7655576437969173
start 0.8630355113023591
end 1.9502833118118699 1.9502931094208702 0.0001 28 0.8630355113023591
start 0.8390770317310635
end 1.950283029470959 1.9502940567240366 0.0001 25 0.8390770317310635
start 0.5400840286618053
end 1.9503013168386334 1.950275171104906 0.0001 4 0.5400840286618053
start 0.5871398213698988
end 1.9502912127883947 1.9502864345385549 0.0001 8 0.5871398213698988
start 0.7815202075700028
end 1.9502844820527192 1.9502934288681588 0.0001 22 0.7815202075700028
start 0.611889513743216
end 1.9502952895356038 1.9502828095208724 0.0001 7 0.611889513743216
start 0.8156114518234251
end 1.9502813700279653 1.9502956710637835 0.0001 27 0.8156114518234251
start 0.6394487237227956
end 1.9502783536306696 1.9502961048050427 0.0001 13 0.6394487237227956
start 0.5680930071091476
end 1.9503003333817008 1.9502775430017747 0.0001 3 0.5680930071091476
start 0.7218399165725775
end 1.950282876685493 1.9502947539879536 0.0001 16 0.7218399165725775
start 0.7429831961819644
end 1.9502842417767203 1.9502932689152277 0.0001 18 0.7429831961819644
start 0.6131507954354968
end 1.9502956207584747 1.950282254680119 0.0001 6 0.6131507954354968
start 0.6604457695940903
end 1.9502859704087725 1.95029163422169 0.0001 12 0.6604457695940903
start 0.5519384233661766
end 1.9503025135118865 1.950275349022502 0.0001 2 0.5519384233661766
start 0.4977420868497499
end 1.9503035785624667 1.9502737200276687 0.0001 0 0.4977420868497499
start 0.636559431215419
end 1.9502875534065165 1.950289503501242 0.0001 11 0.636559431215419
start 0.7532894394747972
end 1.9502838406897836 1.9502940451551296 0.0001 19 0.7532894394747972
start 0.7380355661371412
end 1.9502835098791946 1.9502944997247162 0.0001 20 0.7380355661371412
start 0.6946537192884755
end 1.9502813286239833 1.9502956703645162 0.0001 17 0.6946537192884755
start 0.6982580893706797
end 1.950282453617203 1.9502946046875622 0.0001 14 0.6982580893706797
start 0.8019721003657498
end 1.9502846308729533 1.9502922648246253 0.0001 21 0.8019721003657498
start 0.5972851652797143
end 1.9502883461974636 1.950289696677609 0.0001 9 0.5972851652797143
start 0.6880027728215203
end 1.9502838562087812 1.9502936954094092 0.0001 15 0.6880027728215203

step size: 0.0001
Adjoint FOM: 1.9521019707102925
Adjoint gradient: [-12524.06756616 -12619.86526323  24789.23749582  -7444.77394203
  26183.372689     6618.44657817   2326.90026365  20311.90414861
   4135.46993748 -20863.2470117   21638.7529556  -21967.95810582
   1749.80381309 -13932.9059107     365.30039503  -6812.1188335
  10157.16638342  42181.27199651 -21180.54902175 -10522.06042805
  17937.25987265  39492.22262066 -14120.22400242 -19837.01089069
   5928.67952764  -3729.77965278 -17320.95499979 -10139.82821837
  -8520.0797467   -3354.83610584]

FD FOM: 1.9502887758090952
FD gradient: [-0.06221416582019579, -0.04943937995660619, -0.08000625190685007, 0.14252790432989215, -0.009394946628438205, 0.08976289710971308, -0.04144901424085745, -0.04898804500164111, -0.055136265387778494, 0.130728668636948, 0.02389124919899288, -0.044734077198071986, 0.06240007365709843, -0.07150517909115806, -0.08875587186540912, 0.11395189963070429, -0.059386512303305494, -0.04513569253683514, 0.06683039177834971, -0.028319064587778442, 0.13582244692278422, 0.149292673989887, -0.009750473627390122, -0.05102232673026563, -0.05494922760806986, -0.07170870266470786, -0.0607553517961712, -0.038169758359574146, -0.006752400727449981, -0.0491960031401284]

Now performing an optimization...
E.
======================================================================
ERROR: test_adjoint_solver_gradient (__main__.TestAdjointSolver)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "test_adjoint_solver.py", line 179, in test_adjoint_solver_gradient
    g_discrete, idx, fd0 = optimizer.calculate_fd_gradient(num_gradients=num_gradients,dp=deps,rand=rng,idx=idx,design=design_region)
  File "/zhome/ihammond/GitHub/emepy/emepy/optimization.py", line 550, in calculate_fd_gradient
    fd_gradient_idx[:] = idx[:]
UnboundLocalError: local variable 'fd_gradient_idx' referenced before assignment

----------------------------------------------------------------------
Ran 2 tests in 6180.461s

FAILED (errors=1)
--------------------------------------------------------------------------
MPI_ABORT was invoked on rank 9 in communicator MPI_COMM_WORLD 
with errorcode 1.

NOTE: invoking MPI_ABORT causes Open MPI to kill all MPI processes.
You may or may not see output from other processes, depending on
exactly when Open MPI kills them.
--------------------------------------------------------------------------
